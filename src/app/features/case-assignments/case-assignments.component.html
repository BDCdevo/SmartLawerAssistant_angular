<div class="assignments-container">
  <!-- Compact Header -->
  <div class="page-header-compact">
    <h1 class="header-title">ุฅุฏุงุฑุฉ ุชุนูููุงุช ุงููุถุงูุง</h1>
    <div class="header-actions">
      <button class="action-btn btn-secondary" (click)="onSearch()" [disabled]="loading()">
        <span class="btn-icon" [class.spinning]="loading()">๐</span>
        <span>ุชุญุฏูุซ</span>
      </button>
      <button class="action-btn btn-primary" (click)="openAssignModal()">
        <span class="btn-icon">โ</span>
        <span>ุชุนููู ูุณุชุฎุฏู</span>
      </button>
    </div>
  </div>

  <!-- Compact Filters - Single Row -->
  <div class="filters-compact">
    <div class="filter-group">
      <input
        type="number"
        placeholder="ุฑูู ุงููุถูุฉ"
        [value]="filterCaseId() ?? ''"
        (input)="filterCaseId.set($any($event.target).value ? +$any($event.target).value : undefined)"
      />
    </div>
    <div class="filter-group">
      <input
        type="text"
        placeholder="ูุนุฑู ุงููุณุชุฎุฏู"
        [value]="filterUserId()"
        (input)="filterUserId.set($any($event.target).value)"
      />
    </div>
    <div class="filter-group">
      <select
        [value]="filterRole()"
        (change)="filterRole.set($any($event.target).value)"
      >
        @for (option of roleOptions; track option.value) {
          <option [value]="option.value">{{ option.label }}</option>
        }
      </select>
    </div>
    <div class="filter-group">
      <label class="checkbox-inline">
        <input
          type="checkbox"
          [checked]="showActiveOnly()"
          (change)="showActiveOnly.set($any($event.target).checked)"
        />
        <span>ูุดุท ููุท</span>
      </label>
    </div>
    <button class="search-btn" (click)="onSearch()">ุจุญุซ</button>
    <button class="clear-filters-btn" (click)="clearFilters()">๐๏ธ ูุณุญ</button>
  </div>

  <!-- Loading -->
  @if (loading()) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p>ุฌุงุฑู ุงูุชุญููู...</p>
    </div>
  }

  <!-- Table -->
  @if (!loading()) {
    <div class="table-container">
      <table class="data-table">
        <thead>
          <tr>
            <th>#</th>
            <th>ุฑูู ุงููุถูุฉ</th>
            <th>ุนููุงู ุงููุถูุฉ</th>
            <th>ุงููุณุชุฎุฏู</th>
            <th>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</th>
            <th>ุงูุฏูุฑ</th>
            <th>ุชุงุฑูุฎ ุงูุชุนููู</th>
            <th>ููุงุญุธุงุช</th>
            <th>ุงูุฅุฌุฑุงุกุงุช</th>
          </tr>
        </thead>
        <tbody>
          @if (assignments().length === 0) {
            <tr>
              <td colspan="9" class="no-data">
                <div class="empty-state">
                  <span class="empty-icon">๐</span>
                  <p>ูุง ุชูุฌุฏ ุชุนูููุงุช ูุนุฑุถูุง</p>
                </div>
              </td>
            </tr>
          }
          @for (assignment of assignments(); track assignment.id) {
            <tr [class.deleted-row]="assignment.isDeleted">
              <td>{{ assignment.id }}</td>
              <td class="case-number">{{ assignment.caseNumber || assignment.caseId }}</td>
              <td class="case-title">{{ assignment.caseTitle || '-' }}</td>
              <td class="user-name">{{ assignment.userName || assignment.userId }}</td>
              <td class="user-email">{{ assignment.userEmail || '-' }}</td>
              <td>
                <span class="role-badge">
                  {{ getRoleLabel(assignment.role) }}
                </span>
              </td>
              <td class="date-cell">{{ formatDate(assignment.assignedAt) }}</td>
              <td class="notes-cell">{{ assignment.notes || '-' }}</td>
              <td class="actions-cell">
                @if (!assignment.isDeleted) {
                  <button
                    class="btn-icon btn-unassign"
                    (click)="openUnassignModal(assignment)"
                    title="ุฅูุบุงุก ุงูุชุนููู"
                  >
                    โ
                  </button>
                  <button
                    class="btn-icon btn-delete"
                    (click)="deleteAssignment(assignment.id)"
                    title="ุญุฐู"
                  >
                    ๐๏ธ
                  </button>
                } @else {
                  <button
                    class="btn-icon btn-restore"
                    (click)="restoreAssignment(assignment.id)"
                    title="ุงุณุชุฑุฌุงุน"
                  >
                    โป๏ธ
                  </button>
                }
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    @if (totalPages > 1) {
      <div class="pagination-container">
        <div class="pagination-info">
          ุนุฑุถ <strong>{{ (currentPage() - 1) * pageSize() + 1 }}</strong> -
          <strong>{{ Math.min(currentPage() * pageSize(), totalItems()) }}</strong>
          ูู <strong>{{ totalItems() }}</strong> ุชุนููู
        </div>
        <div class="pagination-controls">
          <button class="page-btn prev-btn" (click)="previousPage()" [disabled]="currentPage() === 1">
            ุงูุณุงุจู
          </button>
          @for (page of pages; track page) {
            <button
              class="page-btn"
              [class.active]="page === currentPage()"
              (click)="goToPage(page)"
            >
              {{ page }}
            </button>
          }
          <button class="page-btn next-btn" (click)="nextPage()" [disabled]="currentPage() === totalPages">
            ุงูุชุงูู
          </button>
        </div>
      </div>
    }
  }
</div>

<!-- Assign Modal -->
@if (showAssignModal()) {
  <div class="modal-overlay" (click)="closeAssignModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>ุชุนููู ูุณุชุฎุฏู ููุถูุฉ</h2>
        <button class="modal-close" (click)="closeAssignModal()">โ</button>
      </div>

      <div class="modal-body">
        <div class="form-group">
          <label class="form-label required">ุฑูู ุงููุถูุฉ</label>
          <input
            type="number"
            class="form-input"
            [value]="assignForm().caseId"
            (input)="updateAssignField('caseId', +$any($event.target).value)"
            placeholder="ุฃุฏุฎู ุฑูู ุงููุถูุฉ"
          />
        </div>

        <div class="form-group">
          <label class="form-label required">ูุนุฑู ุงููุณุชุฎุฏู</label>
          <input
            type="text"
            class="form-input"
            [value]="assignForm().userId"
            (input)="updateAssignField('userId', $any($event.target).value)"
            placeholder="ุฃุฏุฎู ูุนุฑู ุงููุณุชุฎุฏู (User ID)"
          />
        </div>

        <div class="form-group">
          <label class="form-label">ุงูุฏูุฑ</label>
          <select
            class="form-input"
            [value]="assignForm().role"
            (change)="updateAssignField('role', $any($event.target).value)"
          >
            <option value="">ุงุฎุชุฑ ุงูุฏูุฑ (ุงุฎุชูุงุฑู)</option>
            <option value="Lawyer">ูุญุงูู</option>
            <option value="Assistant">ูุณุงุนุฏ</option>
            <option value="Consultant">ูุณุชุดุงุฑ</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">ููุงุญุธุงุช</label>
          <textarea
            class="form-textarea"
            rows="3"
            [value]="assignForm().notes"
            (input)="updateAssignField('notes', $any($event.target).value)"
            placeholder="ููุงุญุธุงุช ุฅุถุงููุฉ (ุงุฎุชูุงุฑู)"
          ></textarea>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeAssignModal()">
          ุฅูุบุงุก
        </button>
        <button class="btn btn-primary" (click)="assignUser()" [disabled]="loading()">
          {{ loading() ? 'ุฌุงุฑู ุงูุชุนููู...' : 'ุชุนููู' }}
        </button>
      </div>
    </div>
  </div>
}

<!-- Unassign Modal -->
@if (showUnassignModal()) {
  <div class="modal-overlay" (click)="closeUnassignModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>ุฅูุบุงุก ุชุนููู ูุณุชุฎุฏู</h2>
        <button class="modal-close" (click)="closeUnassignModal()">โ</button>
      </div>

      <div class="modal-body">
        <div class="unassign-info">
          <p><strong>ุงููุถูุฉ:</strong> {{ selectedAssignment()?.caseNumber || selectedAssignment()?.caseId }}</p>
          <p><strong>ุงููุณุชุฎุฏู:</strong> {{ selectedAssignment()?.userName || selectedAssignment()?.userId }}</p>
          <p><strong>ุงูุฏูุฑ:</strong> {{ getRoleLabel(selectedAssignment()?.role) }}</p>
        </div>

        <div class="form-group">
          <label class="form-label">ููุงุญุธุงุช (ุณุจุจ ุฅูุบุงุก ุงูุชุนููู)</label>
          <textarea
            class="form-textarea"
            rows="3"
            [value]="unassignNotes()"
            (input)="unassignNotes.set($any($event.target).value)"
            placeholder="ุงูุชุจ ุงูุณุจุจ (ุงุฎุชูุงุฑู)"
          ></textarea>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeUnassignModal()">
          ุฅูุบุงุก
        </button>
        <button class="btn btn-danger" (click)="unassignUser()" [disabled]="loading()">
          {{ loading() ? 'ุฌุงุฑู ุงูุฅูุบุงุก...' : 'ุฅูุบุงุก ุงูุชุนููู' }}
        </button>
      </div>
    </div>
  </div>
}
