<div class="rbac-container">
  <!-- Header -->
  <div class="page-header">
    <h1 class="page-title">ุฅุฏุงุฑุฉ ุงูุตูุงุญูุงุช ูุงูุฃุฏูุงุฑ</h1>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="openCreateRoleModal()">
        โ ุฅูุดุงุก ุฏูุฑ ุฌุฏูุฏ
      </button>
      <button class="btn btn-secondary" (click)="openUserRoleModal()">
        ๐ค ุชุนููู ุฏูุฑ ููุณุชุฎุฏู
      </button>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button
      class="tab"
      [class.active]="activeTab() === 'roles'"
      (click)="switchTab('roles')"
    >
      ๐ ุงูุฃุฏูุงุฑ
    </button>
    <button
      class="tab"
      [class.active]="activeTab() === 'permissions'"
      (click)="switchTab('permissions')"
    >
      ๐ ุฅุฏุงุฑุฉ ุงูุตูุงุญูุงุช
    </button>
  </div>

  <!-- Loading -->
  @if (loading()) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p>ุฌุงุฑู ุงูุชุญููู...</p>
    </div>
  }

  <!-- Roles Tab -->
  @if (activeTab() === 'roles' && !loading()) {
    <div class="roles-section">
      <div class="roles-list">
        <h2 class="section-title">ุงูุฃุฏูุงุฑ ุงููุชุงุญุฉ</h2>
        @if (roles().length === 0) {
          <div class="empty-state">
            <span class="empty-icon">๐</span>
            <p>ูุง ุชูุฌุฏ ุฃุฏูุงุฑ</p>
          </div>
        } @else {
          <div class="roles-grid">
            @for (role of roles(); track role.id) {
              <div
                class="role-card"
                [class.selected]="selectedRole()?.id === role.id"
                (click)="selectRole(role)"
              >
                <div class="role-icon">๐</div>
                <div class="role-name">{{ role.name }}</div>
                @if (role.description) {
                  <div class="role-description">{{ role.description }}</div>
                }
              </div>
            }
          </div>
        }
      </div>
    </div>
  }

  <!-- Permissions Tab -->
  @if (activeTab() === 'permissions' && !loading()) {
    <div class="permissions-section">
      @if (!selectedRole()) {
        <div class="empty-state">
          <span class="empty-icon">๐</span>
          <p>ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ุฏูุฑ ูู ูุงุฆูุฉ ุงูุฃุฏูุงุฑ</p>
        </div>
      } @else {
        <div class="permissions-content">
          <h2 class="section-title">
            ุฅุฏุงุฑุฉ ุตูุงุญูุงุช ุงูุฏูุฑ: <span class="highlight">{{ selectedRole()!.name }}</span>
          </h2>

          <div class="permissions-grid">
            <!-- Current Permissions -->
            <div class="permissions-box">
              <h3 class="box-title">ุงูุตูุงุญูุงุช ุงูุญุงููุฉ</h3>
              @if (rolePermissions().length === 0) {
                <div class="empty-message">
                  <p>ูุง ุชูุฌุฏ ุตูุงุญูุงุช ููุฐุง ุงูุฏูุฑ</p>
                </div>
              } @else {
                <div class="permissions-list">
                  @for (permission of rolePermissions(); track permission.id) {
                    <div class="permission-item has-permission">
                      <div class="permission-info">
                        <div class="permission-name">โ {{ permission.name }}</div>
                        <div class="permission-key">{{ permission.key }}</div>
                      </div>
                      <button
                        class="btn-icon btn-remove"
                        (click)="revokePermission(permission)"
                        title="ุฅูุบุงุก ุงูุตูุงุญูุฉ"
                      >
                        โ
                      </button>
                    </div>
                  }
                </div>
              }
            </div>

            <!-- Available Permissions -->
            <div class="permissions-box">
              <h3 class="box-title">ุงูุตูุงุญูุงุช ุงููุชุงุญุฉ</h3>
              @if (availablePermissions().length === 0) {
                <div class="empty-message">
                  <p>ุชู ููุญ ุฌููุน ุงูุตูุงุญูุงุช ููุฐุง ุงูุฏูุฑ</p>
                </div>
              } @else {
                <div class="permissions-list">
                  @for (permission of availablePermissions(); track permission.id) {
                    <div class="permission-item">
                      <div class="permission-info">
                        <div class="permission-name">{{ permission.name }}</div>
                        <div class="permission-key">{{ permission.key }}</div>
                      </div>
                      <button
                        class="btn-icon btn-add"
                        (click)="grantPermission(permission)"
                        title="ููุญ ุงูุตูุงุญูุฉ"
                      >
                        โ
                      </button>
                    </div>
                  }
                </div>
              }
            </div>
          </div>
        </div>
      }
    </div>
  }
</div>

<!-- Create Role Modal -->
@if (showRoleModal()) {
  <div class="modal-overlay" (click)="closeRoleModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>ุฅูุดุงุก ุฏูุฑ ุฌุฏูุฏ</h2>
        <button class="modal-close" (click)="closeRoleModal()">โ</button>
      </div>

      <div class="modal-body">
        <div class="form-group">
          <label class="form-label required">ุงุณู ุงูุฏูุฑ</label>
          <input
            type="text"
            class="form-input"
            [value]="newRoleName()"
            (input)="newRoleName.set($any($event.target).value)"
            placeholder="ูุซุงู: Manager"
          />
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeRoleModal()">
          ุฅูุบุงุก
        </button>
        <button class="btn btn-primary" (click)="createRole()" [disabled]="loading()">
          {{ loading() ? 'ุฌุงุฑู ุงูุฅูุดุงุก...' : 'ุฅูุดุงุก' }}
        </button>
      </div>
    </div>
  </div>
}

<!-- Assign Role to User Modal -->
@if (showUserRoleModal()) {
  <div class="modal-overlay" (click)="closeUserRoleModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>ุชุนููู ุฏูุฑ ููุณุชุฎุฏู</h2>
        <button class="modal-close" (click)="closeUserRoleModal()">โ</button>
      </div>

      <div class="modal-body">
        <div class="form-group">
          <label class="form-label required">ูุนุฑู ุงููุณุชุฎุฏู (User ID)</label>
          <input
            type="text"
            class="form-input"
            [value]="userIdForRole()"
            (input)="userIdForRole.set($any($event.target).value)"
            placeholder="ุฃุฏุฎู ูุนุฑู ุงููุณุชุฎุฏู"
          />
        </div>

        <div class="form-group">
          <label class="form-label required">ุงูุฏูุฑ</label>
          <select
            class="form-input"
            [value]="selectedRoleForUser()"
            (change)="selectedRoleForUser.set($any($event.target).value)"
          >
            <option value="">ุงุฎุชุฑ ุงูุฏูุฑ</option>
            @for (role of roles(); track role.id) {
              <option [value]="role.name">{{ role.name }}</option>
            }
          </select>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeUserRoleModal()">
          ุฅูุบุงุก
        </button>
        <button class="btn btn-primary" (click)="assignRoleToUser()" [disabled]="loading()">
          {{ loading() ? 'ุฌุงุฑู ุงูุชุนููู...' : 'ุชุนููู' }}
        </button>
      </div>
    </div>
  </div>
}
