<!-- Forget Password Modal -->
@if (showModal()) {
  <div class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()" dir="rtl">
      <!-- Header -->
      <div class="modal-header">
        <h2>إعادة تعيين كلمة المرور</h2>
        <button class="close-btn" (click)="closeModal()">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>

      <!-- Progress Steps -->
      <div class="steps-indicator">
        <div class="step" [class.active]="currentStep() >= ForgetPasswordStep.ENTER_PHONE" [class.completed]="currentStep() > ForgetPasswordStep.ENTER_PHONE">
          <div class="step-circle">1</div>
          <span class="step-label">رقم الهاتف</span>
        </div>
        <div class="step-line" [class.completed]="currentStep() > ForgetPasswordStep.ENTER_PHONE"></div>
        <div class="step" [class.active]="currentStep() >= ForgetPasswordStep.VERIFY_OTP" [class.completed]="currentStep() > ForgetPasswordStep.VERIFY_OTP">
          <div class="step-circle">2</div>
          <span class="step-label">رمز التحقق</span>
        </div>
        <div class="step-line" [class.completed]="currentStep() > ForgetPasswordStep.VERIFY_OTP"></div>
        <div class="step" [class.active]="currentStep() >= ForgetPasswordStep.RESET_PASSWORD">
          <div class="step-circle">3</div>
          <span class="step-label">كلمة المرور الجديدة</span>
        </div>
      </div>

      <!-- Step 1: Enter Phone Number -->
      @if (currentStep() === ForgetPasswordStep.ENTER_PHONE) {
        <div class="modal-body">
          <div class="step-icon">📱</div>
          <h3>أدخل رقم هاتفك</h3>
          <p class="step-description">سنرسل لك رمز تحقق على رقم هاتفك</p>

          <div class="form-group">
            <label>رقم الهاتف</label>
            <input
              type="tel"
              [(ngModel)]="phoneNumber"
              placeholder="01012345678"
              class="form-control"
              maxlength="11"
              (keyup.enter)="sendOTP()"
            />
            <small class="form-hint">مثال: 01012345678</small>
          </div>

          <div class="modal-actions">
            <button class="btn btn-secondary" (click)="closeModal()">إلغاء</button>
            <button class="btn btn-primary" (click)="sendOTP()" [disabled]="loading()">
              @if (loading()) {
                <span class="spinner"></span>
                جاري الإرسال...
              } @else {
                إرسال رمز التحقق
              }
            </button>
          </div>
        </div>
      }

      <!-- Step 2: Verify OTP -->
      @if (currentStep() === ForgetPasswordStep.VERIFY_OTP) {
        <div class="modal-body">
          <div class="step-icon">🔐</div>
          <h3>أدخل رمز التحقق</h3>
          <p class="step-description">تم إرسال رمز مكون من 4 أرقام إلى {{ phoneNumber() }}</p>

          <div class="form-group">
            <label>رمز التحقق (OTP)</label>
            <input
              type="text"
              [(ngModel)]="otpCode"
              placeholder="1234"
              class="form-control otp-input"
              maxlength="4"
              (keyup.enter)="verifyOTP()"
            />
          </div>

          <div class="modal-actions">
            <button class="btn btn-secondary" (click)="goBack()">رجوع</button>
            <button class="btn btn-primary" (click)="verifyOTP()" [disabled]="loading()">
              @if (loading()) {
                <span class="spinner"></span>
                جاري التحقق...
              } @else {
                التحقق
              }
            </button>
          </div>

          <div class="resend-section">
            <button class="link-btn" (click)="sendOTP()">
              إعادة إرسال الرمز
            </button>
          </div>
        </div>
      }

      <!-- Step 3: Reset Password -->
      @if (currentStep() === ForgetPasswordStep.RESET_PASSWORD) {
        <div class="modal-body">
          <div class="step-icon">🔑</div>
          <h3>كلمة المرور الجديدة</h3>
          <p class="step-description">أدخل كلمة المرور الجديدة</p>

          <div class="form-group">
            <label>كلمة المرور الجديدة</label>
            <input
              type="password"
              [(ngModel)]="newPassword"
              placeholder="أدخل كلمة المرور الجديدة"
              class="form-control"
              minlength="6"
            />
            <small class="form-hint">6 أحرف على الأقل</small>
          </div>

          <div class="form-group">
            <label>تأكيد كلمة المرور</label>
            <input
              type="password"
              [(ngModel)]="confirmPassword"
              placeholder="أعد إدخال كلمة المرور"
              class="form-control"
              (keyup.enter)="resetPassword()"
            />
          </div>

          <div class="modal-actions">
            <button class="btn btn-secondary" (click)="goBack()">رجوع</button>
            <button class="btn btn-primary" (click)="resetPassword()" [disabled]="loading()">
              @if (loading()) {
                <span class="spinner"></span>
                جاري الحفظ...
              } @else {
                تغيير كلمة المرور
              }
            </button>
          </div>
        </div>
      }
    </div>
  </div>
}
