<div class="nationalities-container">
  <!-- Compact Header -->
  <div class="page-header-compact">
    <h1 class="header-title">ุฅุฏุงุฑุฉ ุงูุฌูุณูุงุช</h1>
    <div class="header-actions">
      <button class="action-btn btn-secondary" (click)="loadNationalities()" [disabled]="loading()">
        <span class="btn-icon" [class.spinning]="loading()">๐</span>
        <span>ุชุญุฏูุซ</span>
      </button>
      <button class="action-btn btn-primary" (click)="openCreateModal()">
        <span class="btn-icon">โ</span>
        <span>ุฅุถุงูุฉ ุฌูุณูุฉ ุฌุฏูุฏุฉ</span>
      </button>
    </div>
  </div>

  <!-- Compact Filters - Single Row -->
  <div class="filters-compact">
    <div class="search-group">
      <input
        type="text"
        placeholder="๐ ุงุจุญุซ ุนู ุฌูุณูุฉ..."
        [value]="searchTerm()"
        (input)="searchTerm.set($any($event.target).value)"
        (keyup.enter)="onSearch()"
      />
      <button class="search-btn" (click)="onSearch()">ุจุญุซ</button>
    </div>
    <div class="filter-group">
      <select
        [value]="showActiveOnly() === undefined ? 'all' : (showActiveOnly() ? 'active' : 'inactive')"
        (change)="showActiveOnly.set($any($event.target).value === 'all' ? undefined : $any($event.target).value === 'active'); onFilterChange()"
      >
        <option value="all">ุงููู</option>
        <option value="active">ูุดุท</option>
        <option value="inactive">ุบูุฑ ูุดุท</option>
      </select>
    </div>
  </div>

  <!-- Loading Spinner -->
  @if (loading()) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p>ุฌุงุฑู ุงูุชุญููู...</p>
    </div>
  }

  <!-- Table -->
  @if (!loading()) {
    <div class="table-container">
      <table class="data-table">
        <thead>
          <tr>
            <th>#</th>
            <th>ุงูุนูู</th>
            <th>ุงูุงุณู ุจุงูุนุฑุจูุฉ</th>
            <th>ุงูุงุณู ุจุงูุฅูุฌููุฒูุฉ</th>
            <th>ุงูุญุงูุฉ</th>
            <th>ุงูุฅุฌุฑุงุกุงุช</th>
          </tr>
        </thead>
        <tbody>
          @if (nationalities().length === 0) {
            <tr>
              <td colspan="6" class="no-data">
                <div class="empty-state">
                  <span class="empty-icon">๐</span>
                  <p>ูุง ุชูุฌุฏ ุจูุงูุงุช ูุนุฑุถูุง</p>
                </div>
              </td>
            </tr>
          }
          @for (nationality of nationalities(); track nationality.id) {
            <tr [class.deleted-row]="nationality.isDeleted">
              <td>{{ nationality.id }}</td>
              <td class="flag-cell">
                <span class="flag-emoji">{{ nationality.flagEmoji || '๐ณ๏ธ' }}</span>
              </td>
              <td class="name-cell">{{ nationality.nameAr }}</td>
              <td class="name-cell-en">{{ nationality.nameEn || '-' }}</td>
              <td>
                <span class="status-badge" [class.active]="nationality.isActive" [class.inactive]="!nationality.isActive">
                  {{ nationality.isActive ? 'ูุดุท' : 'ุบูุฑ ูุดุท' }}
                </span>
              </td>
              <td class="actions-cell">
                @if (!nationality.isDeleted) {
                  <button class="action-btn btn-edit" (click)="openEditModal(nationality)" title="ุชุนุฏูู">
                    โ๏ธ
                  </button>
                  <button class="action-btn btn-delete" (click)="deleteNationality(nationality.id)" title="ุญุฐู">
                    ๐๏ธ
                  </button>
                } @else {
                  <button class="action-btn btn-restore" (click)="restoreNationality(nationality.id)" title="ุงุณุชุฑุฌุงุน">
                    โป๏ธ
                  </button>
                }
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    @if (totalPages > 1) {
      <div class="pagination-container">
        <div class="pagination-info">
          ุนุฑุถ <strong>{{ (currentPage() - 1) * pageSize() + 1 }}</strong> -
          <strong>{{ Math.min(currentPage() * pageSize(), totalItems()) }}</strong>
          ูู <strong>{{ totalItems() }}</strong> ุฌูุณูุฉ
        </div>
        <div class="pagination-controls">
          <button
            class="page-btn prev-btn"
            (click)="previousPage()"
            [disabled]="currentPage() === 1"
          >
            ุงูุณุงุจู
          </button>
          @for (page of pages; track page) {
            <button
              class="page-btn"
              [class.active]="page === currentPage()"
              (click)="goToPage(page)"
            >
              {{ page }}
            </button>
          }
          <button
            class="page-btn next-btn"
            (click)="nextPage()"
            [disabled]="currentPage() === totalPages"
          >
            ุงูุชุงูู
          </button>
        </div>
      </div>
    }
  }
</div>

<!-- Modal -->
@if (showModal()) {
  <div class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ isEditMode() ? 'ุชุนุฏูู ุฌูุณูุฉ' : 'ุฅุถุงูุฉ ุฌูุณูุฉ ุฌุฏูุฏุฉ' }}</h2>
        <button class="modal-close" (click)="closeModal()">โ</button>
      </div>

      <div class="modal-body">
        <div class="form-group">
          <label class="form-label required">ุงูุงุณู ุจุงูุนุฑุจูุฉ</label>
          <input
            type="text"
            class="form-input"
            [value]="formData().nameAr"
            (input)="updateField('nameAr', $any($event.target).value)"
            placeholder="ูุซุงู: ูุตุฑู"
          />
        </div>

        <div class="form-group">
          <label class="form-label">ุงูุงุณู ุจุงูุฅูุฌููุฒูุฉ</label>
          <input
            type="text"
            class="form-input"
            [value]="formData().nameEn"
            (input)="updateField('nameEn', $any($event.target).value)"
            placeholder="Example: Egyptian"
          />
        </div>

        <div class="form-group">
          <label class="form-label">ุงูุนูู (Emoji)</label>
          <input
            type="text"
            class="form-input"
            [value]="formData().flagEmoji"
            (input)="updateField('flagEmoji', $any($event.target).value)"
            placeholder="ูุซุงู: ๐ช๐ฌ"
            maxlength="8"
          />
          <small class="form-hint">ููููู ูุณุฎ ุงูุนูู ูู <a href="https://emojipedia.org/flags" target="_blank">ููุง</a></small>
        </div>

        <div class="form-group">
          <label class="checkbox-label">
            <input
              type="checkbox"
              [checked]="formData().isActive"
              (change)="updateField('isActive', $any($event.target).checked)"
            />
            <span>ูุดุท</span>
          </label>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeModal()">
          ุฅูุบุงุก
        </button>
        <button class="btn btn-primary" (click)="saveNationality()" [disabled]="loading()">
          {{ loading() ? 'ุฌุงุฑู ุงูุญูุธ...' : (isEditMode() ? 'ุชุญุฏูุซ' : 'ุญูุธ') }}
        </button>
      </div>
    </div>
  </div>
}
